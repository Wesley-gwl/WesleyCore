jQuery.extend({ajaxSyncGet:function(n,t){var i=$.ajax({type:"GET",url:n,data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,cache:!1,error:function(n){var t=JSON.parse(n.responseText);alert(t.Message,t.StackTrace)}});return JSON.parse(i.responseText)},ajaxSync:function(n,t){var i=$.ajax({type:"POST",url:n,data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,cache:!1,error:function(n){var t=JSON.parse(n.responseText);alert(t.Message,t.StackTrace)}});return JSON.parse(i.responseText)},ajaxAsync:function(n,t,i){var r=$.Callbacks("unique");r.add(i);$.ajax({type:"POST",url:n,data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,cache:!1,beforeSend:function(){loading(!0)},complete:function(n){loading(!1);r.fire(JSON.parse(n.responseText))},error:function(){}})},ajaxAsyncForm:function(n,t,i){var r=$.Callbacks("unique");r.add(i);$.ajax({type:"POST",url:n,data:t,async:!0,cache:!1,beforeSend:function(){loading(!0)},complete:function(n){loading(!1);r.fire(JSON.parse(n.responseText))},error:function(){}})},QueryString:window.location.search.length<=1?{}:function(n){for(var t,r={},i=0;i<n.length;++i)(t=n[i].split("="),t[0]!="_")&&(r[t[0]]=decodeURIComponent(t[1]));return r}(window.location.search.substr(1).split("&")),addQueryString:function(n){return this.param(this.extend({},this.QueryString,n))},CacheVarSetting:function(n,t){var i=$(document).data("VarFun");i||(i={});i[n]=t;$(document).data("VarFun",i)},GetCacheVar:function(n,t,i,r,u){var f=n,o,e;return t&&(f+="|"+t),i&&(f+="|"+i),r&&(f+="|"+r),u&&(f+="|"+u),o=$(document).data(f),o?o:(e=$(document).data("VarFun"),!e)?null:$.isFunction(e[n])?e[n].call(window,t,i,r,u):null},serializeObject:function(n){for(var r={},i=$((n||"")+" input[name],textarea[name],select[name]"),t=0;t<i.size();t++)r[i.eq(t).attr("name")]=i.eq(t).val();return r},getFormJson:function(n){var t={},i=$(n).serializeArray();return $.each(i,function(){t[this.name]!==undefined?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},setValueFromJson:function(n){var t=JSON.parse(n);$("body").find("*").each(function(){t[this.id]!=undefined&&$(this).html(t[this.id])})},getStrDate:function(n){return eval("new Date("+n.replace(/\d+(?=-[^-]+$)/,function(n){return parseInt(n,10)-1}).match(/\d+/g)+")")},getBeforeDate:function(n,t){var u=n.getFullYear(),i=n.getMonth()+1,r=n.getDate();return r<=t&&(i>1?i=i-1:(u=u-1,i=12)),n.setDate(n.getDate()-t),u=n.getFullYear(),i=n.getMonth()+1,r=n.getDate(),s=u+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)},getAfterDate:function(n,t){var u=n.getFullYear(),i=n.getMonth()+1,r=n.getDate();return r<=t&&(i>1?i=i-1:(u=u-1,i=12)),n.setDate(n.getDate()+t),u=n.getFullYear(),i=n.getMonth()+1,r=n.getDate(),s=u+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)},treeUnSelect:function(n){var t=$(n).tree("getSelected");return t?($(n).find(".tree-node-selected").removeClass("tree-node-selected"),!0):!1},beginDateCalendar:function(n){var t=n?new Date(n):new Date;return{validator:function(n){var i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i>=n}}},beginDateOnSelect:function(n){return function(t){var i=$(n),r=i.datebox("getValue"),u;r&&(u=new Date(r),t>u&&(i.datebox("clear"),i.next().tooltip("error",{content:"由于改变了起始日期，请重新选择截至日期！"})))}},endDateCalendar:function(n){return{validator:function(t){var i=new Date,u=new Date(i.getFullYear(),i.getMonth(),i.getDate()),r=$(n).datebox("getValue");return r?new Date(r)<=t:u<=t}}}});$.extend($.messager,{info:function(){var n,i,t;if(arguments.length<1)throw"info method need least 1 argument";if(n={title:null,msg:null,timeout:1e3,closable:!1,showType:"side",style:{right:"",top:"",bottom:"10%"}},arguments.length==1&&typeof n=="object"){i=arguments[0];for(t in n)i.hasOwnProperty(t)&&(n[t]=i[t]);return $.messager.show(n)}return arguments.length>1&&(n.title=arguments[0],n.msg=arguments[1]),arguments.length>2&&(n.timeout=arguments[2]),arguments.length>3&&(n.showType=arguments[3]),$.messager.show(n)}});$.extend($.fn.datagrid.defaults,{editCellIndex:-1,editCellField:undefined});var htmlInputType=["button","checkbox","file","hidden","image","password","radio","reset","submit","text"];$.extend($.fn.datagrid.methods,{getIndexRow:function(n,t){var i=$(n).datagrid("getRows");return t>=i.length?null:i[t]},editCell:function(n,t){return n.each(function(){var n=this,h=$(n).datagrid("getColumnOption",t.field),u=$(n).datagrid("options"),e,r,f,i,o,s;if(u.editCellIndex>-1&&u.editCellField||!h.editor){if(u.editCellIndex==t.index&&u.editCellField==t.field)return;if(!$(n).datagrid("validateRow",t.index))return;$(n).datagrid("endCellEdit",{field:u.editCellField,index:u.editCellIndex})}for(u.editCellIndex=t.index,u.editCellField=t.field,e=$(this).datagrid("getColumnFields",!0).concat($(this).datagrid("getColumnFields")),r=0;r<e.length;r++)f=$(n).datagrid("getColumnOption",e[r]),f.editor1=f.editor,e[r]!=t.field&&(f.editor=null);for($(n).datagrid("beginEdit",t.index),r=0;r<e.length;r++)f=$(n).datagrid("getColumnOption",e[r]),f.editor=f.editor1;if(i=$(n).datagrid("getEditor",t),!i){$(n).datagrid("endEdit",t.index);return}if(t.OnCellEdit&&typeof t.OnCellEdit=="function"&&t.OnCellEdit(i,t),i.target[0].tagName=="INPUT"&&htmlInputType.indexOf(i.type)>-1?(o=i.target,i.target[0].id||(i.target[0].id=i.type+"_"+(new Date).getTime())):eval("edTarget = $(ed.target)."+i.type+"('textbox')"),o){o.focus();s=$(this).parents(".datagrid");s.on("mousedown."+o[0].id,"",{cellInfo:t,targetId:o[0].id,eventElement:s},function(t){var u;et=$(t.target);var i=t.data.cellInfo,r=t.data.targetId,f=et.is("table.datagrid-btable")||et.parents("table.datagrid-btable").is("table.datagrid-btable"),e=et.closest("td[field="+i.field+"]").length>0;if(f&&e)return(u=et.parents("tr.datagrid-row-editing[datagrid-row-index]").attr("datagrid-row-index"),u==i.index)?!0:(console.log("remove click event %s",r),$("body").off("mousedown."+r),!0);if(!$(n).datagrid("validateRow",i.index))return!0;$(n).datagrid("endCellEdit",i).datagrid("resetCellEditInfo");t.data.eventElement.off("mousedown."+r);console.log("remove click event %s",r)});return $(n)}})},endCellEdit:function(n,t){var u=undefined,i=undefined,r=$(n).datagrid("getEditor",t);return r&&(u=r.target,u[0].classList.contains("combo-f")&&(i=eval("t."+r.type+"('getText')"))),$(n).datagrid("endEdit",t.index),i&&($(n).datagrid("getRows")[t.index][t.field]=i,$(n).datagrid("refreshRow",t.index)),console.log("end edit %s",t.field),n},resetCellEditInfo:function(n){var t=$(n).datagrid("options");t.editCellIndex=-1;t.editCellField=undefined},showTip:function(n,t){t||(t={});var i=n.prevAll().find(".datagrid-body").scrollTop(),r=$(".datagrid-row").height(),u=Math.ceil(i/r),f=n.prevAll().find(".datagrid-row").eq(t.index||u);t.content=t.content||"请选择一行数据";f.tooltip("error",t)},fixRownumber:function(n){return n.each(function(){var t=$(this).datagrid("getPanel"),n=$(".datagrid-cell-rownumber",t).last().clone(),i;n.css({position:"absolute",left:-1e3}).appendTo("body");i=n.width("auto").width();i>25?($(".datagrid-header-rownumber,.datagrid-cell-rownumber",t).width(i+5),$(this).datagrid("resize"),n.remove(),n=null):$(".datagrid-header-rownumber,.datagrid-cell-rownumber",t).removeAttr("style")})}});$.extend($.fn.validatebox.defaults.rules,{idCard:{validator:function(n){return/^\d{15}(\d{2}[A-Za-z0-9])?$/i.test(n)},message:"身份证号码格式不正确"},minLength:{validator:function(n,t){return n.length>=t[0]},message:"请输入至少{0}个字符."},maxLength:{validator:function(n,t){return n.length<=t[0]},message:"不能超过{0}个字符."},length:{validator:function(n,t){var i=$.trim(n).length;return i>=t[0]&&i<=t[1]},message:"输入内容长度必须介于{0}和{1}之间."},phone:{validator:function(n){return/^((\d2,3)|(\d{3}\-))?(0\d2,3|0\d{2,3}-)?[1-9]\d{6,7}(\-\d{1,4})?$/i.test(n)},message:"格式不正确,请使用下面格式:020-88888888"},mobile:{validator:function(n){return/^[1][3,4,5,7,8][0-9]{9}$/i.test(n)},message:"手机号码格式不正确"},intOrFloat:{validator:function(n){return/^\d+(\.\d+)?$/i.test(n)},message:"请输入数字，并确保格式正确"},currency:{validator:function(n){return/^\d+(\.\d+)?$/i.test(n)},message:"货币格式不正确"},qq:{validator:function(n){return/^[1-9]\d{4,9}$/i.test(n)},message:"QQ号码格式不正确"},integer:{validator:function(n){return/^([+]?[0-9])|([-]?[0-9])+\d*$/i.test(n)},message:"请输入整数"},age:{validator:function(n){return/^(?:[1-9][0-9]?|1[01][0-9]|120)$/i.test(n)},message:"年龄必须是0到120之间的整数"},chinese:{validator:function(n){return/^[\Α-\￥]+$/i.test(n)},message:"请输入中文"},english:{validator:function(n){return/^[A-Za-z]+$/i.test(n)},message:"请输入英文"},unnormal:{validator:function(n){return/.+/i.test(n)},message:"输入值不能为空和包含其他非法字符"},faxno:{validator:function(n){return/^((\d2,3)|(\d{3}\-))?(0\d2,3|0\d{2,3}-)?[1-9]\d{6,7}(\-\d{1,4})?$/i.test(n)},message:"传真号码不正确"},zip:{validator:function(n){return/^[1-9]\d{5}$/i.test(n)},message:"邮政编码格式不正确"},email:{validator:function(n){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+$/i.test(n)},message:"邮箱格式不正确"},ip:{validator:function(n){return/((25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))/i.test(n)},message:"IP地址格式不正确"},name:{validator:function(n){return/^[\Α-\￥]+$/i.test(n)|/^\w+[\w\s]+\w+$/i.test(n)},message:"请输入姓名"},date:{validator:function(n){return/^(?:(?!0000)[0-9]{4}([-]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-]?)0?2\2(?:29))$/i.test(n)},message:"清输入合适的日期格式"},endTime:{validator:function(n,t){return n>=$(t[0]).val()},message:"结束日期不能小于开始日期"},startTime:{validator:function(n,t){return n<=$(t[0]).val()},message:"开始日期不能大于结束日期"}});$.extend($.fn.tree.methods,{editCell:function(n,t){return n.each(function(){var n=this,s=$(n).treegrid("getColumnOption",t.field),h,f,r,u,i,e,o;if(s.editor){for(h=$(n).treegrid("options"),f=$(this).treegrid("getColumnFields",!0).concat($(this).treegrid("getColumnFields")),r=0;r<f.length;r++)u=$(n).treegrid("getColumnOption",f[r]),u.editor1=u.editor,f[r]!=t.field&&(u.editor=null);for($(n).treegrid("beginEdit",t.index),r=0;r<f.length;r++)u=$(n).treegrid("getColumnOption",f[r]),u.editor=u.editor1;if(i=$(n).treegrid("getEditor",t),!i){$(n).treegrid("endEdit",t.index);return}if(t.OnCellEdit&&typeof t.OnCellEdit=="function"&&t.OnCellEdit(i,t),i.target[0].tagName=="INPUT"&&htmlInputType.indexOf(i.type)>-1?(e=i.target,i.target[0].id||(i.target[0].id=i.type+"_"+(new Date).getTime())):eval("edTarget=$(ed.target)."+i.type+"('textbox')"),e){e.focus();o=$(this).parents(".datagrid");o.on("mousedown."+e[0].id,"",{cellInfo:t,targetId:e[0].id,eventElement:o},function(t){et=$(t.target);var i=t.data.cellInfo,r=t.data.targetId,o=et.is("td[field="+i.field+"]")||et.is("td[field="+i.field+"] div.datagrid-cell");if((!o||!et.find("#"+r).is("#"+r))&&$(n).treegrid("validateRow",i.index)){var e=undefined,u=undefined,f=$(n).treegrid("getEditor",i);f&&(e=f.target,e[0].classList.contains("combo-f")&&(u=eval("t."+f.type+"('getText')")));$(n).treegrid("endEdit",i.index);u&&($(n).treegrid("getSelected")[i.field]=u,$(n).treegrid("refreshRow",i.index));t.data.eventElement.off("mousedown."+r)}})}}})},getParents:function(n,t){t||(t=n.tree("getSelected"));var i=[];return function r(){var u=n.tree("getParent",t.target);u&&(i.push(t=u),r())}(),i},showTip:function(n,t){t||(t={});var i=n.find(".tree-node .tree-title").eq(t.index||0);t.content||(t.content="请选择一个结点");i.tooltip("error",t)},getTextChar:function(n,t){var r=$(n).tree("getSelected"),i;if(!r)return[];i=$(n).tree("getParents",r);i.reverse();i.push(r);var u=i.map(n=>n.text),f=u.slice(t.lStart||0,t.lEnd||u.length),e=f.map(n=>n[t.index||0]);return e.join(t.split||"")},getLevel:function(n,t){t||(t=$(n).tree("getSelected"));var i=$(n).tree("getParents",t);return i.length+1},isLeafNode:function(n,t){t||(t=$(n).tree("getSelected"));let i=$(n).tree("getChildren",t.target);return!(i.length>0)},isRootNode:function(n,t){t||(t=$(n).tree("getSelected"));let i=$(n).tree("getParent",t.target);return!i}});$.extend($.fn.tooltip.methods,{error:(n,t)=>{t.onShow||(t.onShow=()=>{n.tooltip("tip").css({backgroundColor:"rgb(255,255,204)"}),setTimeout(()=>{n.tooltip("hide")},1500)}),t.onHide||(t.onHide=()=>n.tooltip("destroy")),n.tooltip(t).tooltip("show")}});$.extend($.fn.combogrid.methods,{getSelected:function(n){return $(n).combogrid("grid").datagrid("getSelected")},reload:function(n){return $(n).combogrid("grid").datagrid("reload")}});$.extend($.fn.combotree.methods,{getSelected:function(n){return $(n).combotree("tree").tree("getSelected")},getChildren:function(n,t){return $(n).combotree("tree").tree("getChildren",t)},reload:function(n){return $(n).combotree("tree").tree("reload")}});